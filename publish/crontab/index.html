<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Team <teamname>">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>How to automate running your tool? - Development manual</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "How to automate running your tool?";
    var mkdocs_page_input_path = "publish/crontab.md";
    var mkdocs_page_url = "/development/publish/crontab/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Development manual</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../tools/">What are the commonly used tools?</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Choose a development workflow</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../dev/models/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/githubflow/">github flow</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dev/gitflow/">git flow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How do confine my project?</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../conda/conda_conventions/">How to name your conda env</a>
                </li>
                <li class="">
                    
    <a class="" href="../../conda/activate/">How do I activate an env?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../perl/installation/perlbrew/">How do I manage perl and cpanm?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../editors/">Choose your editor :)</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How do we use Python?</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python/conventions/">conventions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/variables/">variables</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/logging/">logging</a>
                </li>
                <li class="">
                    
    <span class="caption-text">How to write unit tests?</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../python/testing/">GIVEN-WHEN-THEN</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../python/testing/fixtures/">Are you using fixtures?</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How to publish your tool?</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../prod/">How to publish your tool?</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">How to automate running your tool?</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#crontab">Crontab</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#tldr">TL;DR</a></li>
        
            <li><a class="toctree-l4" href="#edit-the-crontab">Edit the crontab</a></li>
        
            <li><a class="toctree-l4" href="#crontab-format">Crontab format</a></li>
        
            <li><a class="toctree-l4" href="#errors">Errors!</a></li>
        
            <li><a class="toctree-l4" href="#only-errors">Only errors!</a></li>
        
            <li><a class="toctree-l4" href="#cronic">Cronic</a></li>
        
            <li><a class="toctree-l4" href="#logging">Logging</a></li>
        
            <li><a class="toctree-l4" href="#cronic_1">$CRONIC</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../update-scripts/">How make updating your tool easy?</a>
                </li>
                <li class="">
                    
    <a class="" href="../servers/">How to update configuration?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">How do we use github?</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../github/pr/">How to make a pull request?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../github/pr-request/">How to request a pull request review?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Other recommendations?</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../perl/">What if I need perl?</a>
                </li>
                <li class="">
                    
    <a class="" href="../../perl/best_practises/best_practises/">What are perl's best practices?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../mkdocs/">How do I publish this manual?</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Development manual</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>How to publish your tool? &raquo;</li>
        
      
    
    <li>How to automate running your tool?</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Clinical-Genomics/development/edit/master/docs/publish/crontab.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="crontab">Crontab</h1>
<p><a href="https://en.wikipedia.org/wiki/Cron">Cron</a> is a unix tool to run programs at certain times. Automatically! How great is that?
Cron saves this information into a file called <code>crontab</code>. Sometimes, cron and crontab are used interchangeably.</p>
<p>This document outlines how to write the perfect crontab entry.</p>
<h2 id="tldr">TL;DR</h2>
<pre><code>0 0 * * * $CRONIC your-awesome-program &gt;&gt; your-awesome.log 2&gt; &gt;(tee -a your-awesome.log &gt;&amp;2)
</code></pre>

<p>We use <code>$CRONIC</code> to make sure only errors are emailed.</p>
<p>That's it! How does it work? Read on!</p>
<h2 id="edit-the-crontab">Edit the crontab</h2>
<pre><code>crontab -e
</code></pre>

<p>This will drop you into a <code>vim</code> session.</p>
<h2 id="crontab-format">Crontab format</h2>
<pre><code> ┌───────────── minute (0 - 59)
 │ ┌───────────── hour (0 - 23)
 │ │ ┌───────────── day of month (1 - 31)
 │ │ │ ┌───────────── month (1 - 12)
 │ │ │ │ ┌───────────── day of week (0 - 6) (Sunday to Saturday;
 │ │ │ │ │                                       7 is also Sunday on some systems)
 │ │ │ │ │
 │ │ │ │ │
 * * * * *  command to execute
</code></pre>

<p>See <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> for more explanation on crontab's format.</p>
<h2 id="errors">Errors!</h2>
<p>You really want to be notified when your automation goes wrong. This line will add an email address to the crontab<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>.</p>
<p><code>MAILTO=clinical-logwatch@scilifelab.se</code></p>
<p>This will mail any output made by a crontab started program to the above mentioned email address.</p>
<h2 id="only-errors">Only errors!</h2>
<p>You don't want to be spammed with <em>all</em> output of your programs. You only want to be notified when something goes wrong.</p>
<p>What does it mean "to go wrong"?</p>
<p>On the highest level, this mean when a program exits with a non-zero exit code. To make sure we only get emailed with the full output of our program when the program exits with a non-zero exit code, we make use of <a href="https://github.com/Clinical-Genomics/servers/blob/master/resources/cronic">cronic</a>.
Cronic will capture all output of your program, including everything printed to stderr. If all goes well, all that captured output will be printed to stdout, including everything that was caught from stderr. Only when the program exits with a non-zero exit status will everything be printed to stderr.</p>
<h2 id="cronic">Cronic</h2>
<p>How can we make use of this nifty feature?</p>
<p>Like this:</p>
<p><code>cronic your-awesome-program &gt;&gt; your-awesome.log</code></p>
<p>All output to stdout will be caught by your log (all went well!). All output to stderr will be caught by crontab which will send it by email if <code>MAILTO</code> is set (program exited with non-zero exit code).</p>
<h2 id="logging">Logging</h2>
<p>What if you also want to log all output, even when something goes wrong?</p>
<p>Then comes in some bash magic <sup id="fnref2:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<pre><code>SHELL=/bin/bash
cronic your-awesome-program &gt;&gt; your-awesome.log 2&gt; &gt;(tee -a your-awesome.log &gt;&amp;2)
</code></pre>

<p>Here we add a stderr redirect (<code>2&gt;</code>) to the program <a href="https://en.wikipedia.org/wiki/Tee_(command)">tee</a>. Tee captures all stdin (through <code>&gt;(tee ...)</code> <a href="http://tldp.org/LDP/abs/html/process-sub.html">process substitution</a>), appends it to your-awesome.log, and prints stdin back to stdout. Stdout gets redirected to stderr (<code>&gt;&amp;2</code>). And remember: stderr is sent to crontab, which will mail the content to <code>MAILTO</code> if set.</p>
<h2 id="cronic_1">$CRONIC</h2>
<p>Lastly, you do not want to write the full path to <code>cronic</code> for each crontab entry. Create a bash variable at the start of the crontab, which you then can use in your crontab entry: <sup id="fnref3:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<pre><code>CRONIC=~/server/resources/cronic
0 0 * * * $CRONIC your-awesome-program &gt;&gt; your-awesome.log 2&gt; &gt;(tee -a your-awesome.log &gt;&amp;2)
</code></pre>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Please be aware that in most certainty, the shell variables <code>SHELL</code>, <code>MAILTO</code>, and <code>CRONIC</code> will already by set at the top of the server's crontab.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../update-scripts/" class="btn btn-neutral float-right" title="How make updating your tool easy?">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../prod/" class="btn btn-neutral" title="How to publish your tool?"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Clinical-Genomics/development/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../prod/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../update-scripts/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
